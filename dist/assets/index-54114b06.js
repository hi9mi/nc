var B=Object.defineProperty;var H=(i,e,t)=>e in i?B(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>(H(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function P(i,e,t){return i+(e-i)*t}function m(i=0,e=1){return Math.random()*(e-i)+i}const q=()=>m(0,2*Math.PI);class p{constructor(e,t,a,s=1){this.r=e,this.g=t,this.b=a,this.a=s}toString(){return`rgba(${this.r*255},${this.g*255},${this.b*255}, ${this.a})`}grayScale(e=1){const t=(this.r+this.g+this.b)/3;return new p(P(this.r,t,e),P(this.g,t,e),P(this.b,t,e),this.a)}withAlpha(e){return new p(this.r,this.g,this.b,e)}invert(){return new p(1-this.r,1-this.g,1-this.b,this.a)}static hex(e){const t=e.match(/#([0-9a-z]{2})([0-9a-z]{2})([0-9a-z]{2})/i);if(t){const[,a,s,n]=t;return new p(parseInt(a,16)/255,parseInt(s,16)/255,parseInt(n,16)/255)}else throw new Error(`Invalid hex color: ${e}`)}}class r{constructor(e,t){this.x=e,this.y=t}add(e){return new r(this.x+e.x,this.y+e.y)}sub(e){return new r(this.x-e.x,this.y-e.y)}scale(e){return new r(this.x*e,this.y*e)}len(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.len();return new r(this.x/e,this.y/e)}dist(e){return this.sub(e).len()}static polar(e,t){return new r(Math.cos(t)*e,Math.sin(t)*e)}}let S=0;function L(i,e,t,a){i.fillStyle=a.grayScale(S).toString(),i.beginPath(),i.arc(e.x,e.y,t,0,2*Math.PI,!1),i.fill()}function J(i,e,t,a,s,n){i.fillStyle=n.grayScale(S).toString(),i.fillRect(e,t,a,s)}function y(i,e,t,a={x:i.canvas.width/2,y:i.canvas.height/2,maxWidth:i.canvas.width/2,lineHeight:50,fontSize:30,textAlign:"center"}){let{x:s,y:n,maxWidth:h,lineHeight:$,fontSize:G,textAlign:K}=a;i.fillStyle=t.toString(),i.font=`${G}px Lexend Mega`,i.textAlign=K;let d=e.split(" "),g="",I="",M=[];for(let l=0;l<d.length;l++)I+=`${d[l]} `,i.measureText(I).width>h&&l>0?(M.push([g,s,n]),n+=$,g=`${d[l]} `,I=`${d[l]} `):g+=`${d[l]} `,l===d.length-1&&M.push([g,s,n]);M.forEach(([l,T,N])=>{i.fillText(l,T,N)})}const A=p.hex("#f43841"),c=69,F=750,u=100,v=7,k=u/10,D=1.7,_=42,U=1500,X=5,j=F/3,R=c,Y=p.hex("#9e95c7"),Q=1,Z=1500,V=u/5,ee=100,te=[0,50],se=[10,20],ie=[0,U],W=1,ne=[0,W],E=p.hex("#ffffff"),w="best_score",C=new Map([["KeyS",new r(0,1)],["KeyW",new r(0,-1)],["KeyA",new r(-1,0)],["KeyD",new r(1,0)]]);class ae{constructor(e,t,a,s,n){this.pos=e,this.vel=t,this.lifetime=a,this.radius=s,this.color=n}update(e){this.pos=this.pos.add(this.vel.scale(e)),this.lifetime-=e}render(e){const t=this.lifetime/W;L(e,this.pos,this.radius,this.color.withAlpha(t))}}function x(i,e,t){const a=m(...te);for(let s=0;s<a;s++)i.push(new ae(e,r.polar(m(...ie),q()),m(...ne),m(...se),t))}class re{constructor(e){this.pos=e,this.dead=!1}update(e,t){const a=t.sub(this.pos).normalize().scale(j*e);this.pos=this.pos.add(a)}render(e){L(e,this.pos,R,Y)}}class oe{constructor(e,t){this.pos=e,this.vel=t,this.lifetime=X}update(e){this.pos=this.pos.add(this.vel.scale(e)),this.lifetime-=e}render(e){L(e,this.pos,_,A)}}class he{constructor(e){this.alpha=0,this.dalpha=0,this.text=e,this.onFadedOut=void 0,this.onFadedIn=void 0}update(e){var t,a;this.alpha+=this.dalpha*e,this.dalpha<0&&this.alpha<0?(this.dalpha=0,this.alpha=0,(t=this.onFadedOut)==null||t.call(this)):this.dalpha>0&&this.alpha>=1&&(this.dalpha=0,this.alpha=1,(a=this.onFadedIn)==null||a.call(this))}render(e){y(e,this.text,E.withAlpha(this.alpha))}fadeIn(){this.dalpha=D}fadeOut(){this.dalpha=-D}}const b=Object.freeze({LearningMovement:0,LearningShooting:1,Finished:2}),z=Object.freeze(["WASD to move","Left Mouse Click to shoot",""]);class le{constructor(){this.state=0,this.popup=new he(z[this.state]),this.popup.fadeIn(),this.popup.onFadedOut=()=>{this.popup.text=z[this.state],this.popup.fadeIn()}}update(e){this.popup.update(e)}render(e){this.popup.render(e)}playerMoved(){this.state===b.LearningMovement&&(this.popup.fadeOut(),this.state+=1)}playerShot(){this.state===b.LearningShooting&&(this.popup.fadeOut(),this.state+=1)}}function O(i,e){for(const t of e)t.render(i)}class pe{constructor(e){o(this,"hp",u);this.pos=e}render(e){this.hp>0&&L(e,this.pos,c,A)}update(e,t){this.pos=this.pos.add(t.scale(e))}shootAt(e){const t=e.sub(this.pos).normalize(),a=t.scale(U),s=this.pos.add(t.scale(c+_));return new oe(s,a)}damage(e){this.hp=Math.max(this.hp-e,0)}heal(e){this.hp=Math.min(this.hp+e,u)}}class de{constructor(){o(this,"player",new pe(new r(c+100,c+100)));o(this,"mousePos",new r(0,0));o(this,"pressedKeys",new Set);o(this,"tutorial",new le);o(this,"bullets",[]);o(this,"enemies",[]);o(this,"particles",[]);o(this,"enemySpawnRate",Q);o(this,"enemySpawnCooldown",this.enemySpawnRate);o(this,"paused",!1);o(this,"score",0)}update(e){if(this.paused){S=1;return}else S=1-this.player.hp/u;this.player.hp<=0&&(e/=50);let t=new r(0,0),a=!1;for(const s of this.pressedKeys)C.has(s)&&(t=t.add(C.get(s).scale(F)),a=!0);a&&this.tutorial.playerMoved(),this.player.update(e,t),this.tutorial.update(e);for(const s of this.enemies)if(!s.dead){for(const n of this.bullets)if(s.pos.dist(n.pos)<=_+R){this.score+=ee;let h=localStorage.getItem(w);h?(h=Math.max(JSON.parse(h),this.score),localStorage.setItem(w,JSON.stringify(h))):localStorage.setItem(w,JSON.stringify(this.score)),this.player.heal(k),s.dead=!0,n.lifetime=0,x(this.particles,s.pos,Y)}this.player.hp>0&&s.pos.dist(this.player.pos)<=c+R&&(this.player.damage(V),s.dead=!0,x(this.particles,s.pos,A))}for(const s of this.bullets)s.update(e);this.bullets=this.bullets.filter(s=>s.lifetime>0);for(const s of this.particles)s.update(e);this.particles=this.particles.filter(s=>s.lifetime>0);for(const s of this.enemies)s.update(e,this.player.pos);this.enemies=this.enemies.filter(s=>!s.dead),this.tutorial.state===b.Finished&&(this.enemySpawnCooldown-=e,this.enemySpawnCooldown<=0&&(this.spawnEnemy(),this.enemySpawnCooldown=this.enemySpawnRate,this.enemySpawnRate=Math.max(.01,this.enemySpawnRate-.01)))}render(e){const t=e.canvas.width,a=e.canvas.height;e.clearRect(0,0,t,a),this.player.render(e),O(e,this.bullets),O(e,this.particles),O(e,this.enemies),this.paused?y(e,"GAME IS PAUSED (press SPACE to resume game)",E):this.player.hp<=0?y(e,"YOU DIED (refresh the page to restart game)",E):this.tutorial.render(e),y(e,`SCORE: ${this.score}`,E,{x:10,y:30,maxWidth:t/2,lineHeight:1,fontSize:16,textAlign:"left"});const s=localStorage.getItem(w);s&&y(e,`BEST SCORE: ${JSON.parse(s)}`,E,{x:10,y:60,maxWidth:t/2,lineHeight:1,fontSize:16,textAlign:"left"}),J(e,0,a-v,t*(this.player.hp/u),v,A)}spawnEnemy(){const e=Math.random()*2*Math.PI;this.enemies.push(new re(this.player.pos.add(r.polar(Z,e))))}togglePause(){this.paused=!this.paused}keyDown(e){this.player.hp<=0||(e.code==="Space"&&this.togglePause(),this.pressedKeys.add(e.code))}keyUp(e){this.pressedKeys.delete(e.code)}mouseDown(e){if(this.paused||this.player.hp<=0)return;this.tutorial.playerShot();const t=new r(e.offsetX,e.offsetY);this.bullets.push(this.player.shootAt(t))}}const f=new de,ce=i=>{const e=i.getContext("2d");let t,a=!0;function s(n){t===void 0&&(t=n);const h=(n-t)*.001;t=n,a&&(i.width=document.documentElement.clientWidth,i.height=document.documentElement.clientHeight,a=!1),f.update(h),f.render(e),window.requestAnimationFrame(s)}window.requestAnimationFrame(s),document.addEventListener("keydown",n=>{f.keyDown(n)}),document.addEventListener("keyup",n=>{f.keyUp(n)}),document.addEventListener("mousedown",n=>{f.mouseDown(n)}),window.addEventListener("resize",()=>{a=!0})};document.querySelector("#app").innerHTML=`
  <canvas id="game"></canvas>
`;ce(document.getElementById("game"));
